
一个 SQL 提交到数据库，首先经过连接器将 SQL 语句交给语法分析器，生成一个抽象请求树(AST)；AST 经过语义分析与优化器，进行语义优化，使计算过程和需要获取的中间数据尽可能少，然后得到数据库执行计划；执行计划提交给具体的执行引擎进行计算，将结果通过连接器再返回给应用程序。如下:
```s
          +-------+    +----------+    +----------------+   +---------+
  SQL --->+ 连接器 +--->+ 语法分析器 +--->+ 语义分析与优化器 +--->+ 执行引擎 +
          +-------+    +----------+    +----------------+   +---------+
```
应用程序提交 SQL 到数据库执行时，需要建立与数据库的连接。数据库连接器会为每个连接请求分配一块专用的内存空间，用于会话上下文管理。建立连接对数据库而言相对较大，需要花费一定的时间，因此应用程序启动时，通常会初始化建立一些数据库连接并放在连接池里，这样当处理外部请求执行 SQL 操作的时候，就不需要花费时间建立连接了。

这些连接一旦建立，不管是否有 SQL 执行，都会消耗一定的数据库内存资源，所以对于一个大规模互联网应用集群来说，如果启动了很多应用程序实例，这些程序都会与数据库建立若干连接，即使不提交 SQL 到数据库执行，也会对数据库造成很大的压力。

所以应用程序需要对数据库连接进行管理。一方面通过连接池对连接进行管理，空闲连接会被及时释放；另一方面微服务架构可以大大减少数据库连接，比如，对于用户数据库来说，所有应用都需要连接到用户数据库，而如果划分一个用户微服务，并独立部署一个比较小的集群，那么，只有这几个用户微服务实例需要连接用户数据库，这样一来需要建立的连接数量大大减少。

连接器收到 SQL 以后，会将 SQL 交给语法分析器进行处理，语法分析器的工作比较简单，也比较机械，就是根据 SQL 语法规则生成对应的抽象语法树。

语法分析器生成的抽象语法树不仅可以用来做语法校验，它也是下一步处理的基础。语义分析与优化器会对抽象语法树进一步做语义优化，也就是在保证 SQL 语义不变的前提下，进行语义等价转换，使最后的计算量和中间过程数据量尽可能小。

`SQL 语义分析与优化器就是要将各种复杂嵌套的 SQL 进行语义等价转化，得到有限的几种关系代数计算结构，并利用索引等信息进一步进行优化。可以说，各个数据库最有技术含量的部分就是在优化这里了`。

语义分析与优化器最后会输出一个执行计划，由执行引擎完成数据查询或者更新。

执行引擎是可替换的，只要能够执行这个计划就可以了。比如 MySQL 有多种执行引擎(也就存储引擎)可以选择，缺省的是 InnoDB，此外还有 MyISAM、Memory 等。
